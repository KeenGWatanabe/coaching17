# for production use tf-backend for tfstate files
terraform {
  backend "s3" {
    bucket         = "rgers3.tfstate-backend.com"  # Must match the bucket name above
    key            = "terraform.tfstate"        # State file path
    region         = "us-east-1"                # Same as provider
    encrypt        = true                       # Use encryption
    dynamodb_table = "terraform-state-locks"    # If using DynamoDB
  }
}

# 1 terraform commands
terraform init

# 2 First create dependencies
terraform apply -target=aws_ecr_repository.app

# 3 if iam_role exists, else only run step 1,2 & 4
#terraform import aws_iam_role.ecs_exec_role myapp-ecs-exec-role

# 4 Then full apply
terraform apply



---

### **Key Additions**:
1. **VPC Setup**:  
   - Public subnets, Internet Gateway, and route tables for Fargate tasks with `assign_public_ip = true`.  
2. **Security Group**:  
   - Allows inbound traffic to port `8080` (adjust as needed).  
3. **ECR Repository**:  
   - Automatically created and linked to the ECS task definition.  
4. **Subnet/SG References**:  
   - Dynamically passes subnet IDs and security group IDs to the ECS module.  

[Static container amendments instead of dynamic](/docs/StaticContainer.md)
---

### **Next Steps**:
1. Run `terraform init` and `terraform apply`.  
2. Push your Docker image to ECR:  
   ```bash
   aws ecr get-login-password | docker login --username AWS --password-stdin ACCOUNT_ID.dkr.ecr.REGION.amazonaws.com
   docker build -t ${local.prefix}-ecr .
   docker tag ${local.prefix}-ecr:latest ${aws_ecr_repository.app.repository_url}:latest
   docker push ${aws_ecr_repository.app.repository_url}:latest
   ```
3. Access your service at the public IP of the ECS task (check AWS Console > ECS > Tasks).  

Let me know if you'd like to add ALB/Route53 or other components!

yaml
credentials
gh > aws /tf > docker >  
.
├── .github/
│   └── workflows/
│       └── deploy.yml
├── Dockerfile
├── app.py
└── terraform/
    ├── main.tf
    ├── variables.tf
    ├── outputs.tf
    ├── .terraform/          # Auto-generated by `terraform init` (DO NOT commit)
    └── .terraform.lock.hcl  # Auto-generated (DO commit)
    [yaml explained](/docs/yamlExplain.md)